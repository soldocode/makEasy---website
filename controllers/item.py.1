# coding: utf8
# prova qualcosa come

import json
import math
from dxfwrite import DXFEngine as dxf
import cStringIO
import sys, os
import makEasy

pathname = os.path.abspath(os.path.dirname(sys.argv[0]))
sysfolder=pathname.split('web2py')[0]
prjfolder=sysfolder+"PyApp\\makEasy\\Projects\\"


def create():
    if request.vars.newproject:
        projectName=request.vars.newproject
        meprj=makEasy.projectLibrary[projectName]
        path_prj=meprj.Path

        # load form structure
        f = open(prjfolder+path_prj+'\\form.json', 'r')
        formdata=json.load(f)
        f.close()
        print form
        form=SCRIPT('var form_data='+json.dumps(formdata))


        # load js functions
        f = open(prjfolder+path_prj+'\\form.js', 'r')
        javascriptfunctions=f.read()
        f.close()
        scripts=SCRIPT(javascriptfunctions)
    else:
        form=''
        scripts=''

    return locals()


def exportDXF():

    if request.vars.project:
        projectName=request.vars.project
        meprj=makEasy.projectLibrary[projectName]
        data=json.loads(request.vars.jsonstring)
        dxf_result=meprj.ExportDXF(data)

    return json.dumps(dxf_result)
